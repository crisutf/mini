<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCrisutf</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="background-glow"></div>
    <div class="container">
        <!-- Landing Page Content -->
        <div id="landing-view">
            <h1>Crisutf</h1>

        <!-- Redirecting State -->
        <div id="redirect-view" class="loader">
            <div class="spinner"></div>
        </div>

        <!-- Error State -->
        <div id="error-view" class="error-message">
            <p id="error-text">Enlace no encontrado</p>
        </div>
    </div>

    <script>
        async function handleRedirect() {
            const urlParams = new URLSearchParams(window.location.search);
            let destinationKey = urlParams.get('d');

            if (!destinationKey) {
                const path = window.location.pathname.replace(/^\//, '').replace(/\/$/, '');
                if (path) {
                    destinationKey = path;
                }
            }

            const landingView = document.getElementById('landing-view');
            const redirectView = document.getElementById('redirect-view');
            const errorView = document.getElementById('error-view');
            const errorText = document.getElementById('error-text');

            if (!destinationKey) {
                return;
            }

            // Switch to loading state
            landingView.style.display = 'none';
            redirectView.style.display = 'flex';

            try {
                const response = await fetch('links.json');
                if (!response.ok) throw new Error('Failed to load links');

                const links = await response.json();
                const key = destinationKey.trim().toLowerCase();
                const targetUrl = links[key] || links[destinationKey];

                if (targetUrl) {
                    window.location.replace(targetUrl);
                } else {
                    throw new Error('Link not found');
                }
            } catch (error) {
                console.error(error);
                redirectView.style.display = 'none';
                landingView.style.display = 'block';
                if (errorText && destinationKey) {
                    errorText.textContent = 'No encontr√© el enlace para "' + destinationKey + '"';
                }
                errorView.style.display = 'block';
            }
        }

        async function loadLinks() {
            const section = document.getElementById('links-section');
            const list = document.getElementById('links-list');
            if (!section || !list) return;

            try {
                const response = await fetch('links.json');
                if (!response.ok) return;

                const links = await response.json();
                const entries = Object.entries(links);
                if (!entries.length) return;

                section.style.display = 'block';
                list.innerHTML = '';

                entries.forEach(function (entry) {
                    const key = entry[0];
                    const item = document.createElement('button');
                    item.className = 'link-item';
                    item.type = 'button';
                    item.textContent = key;
                    item.addEventListener('click', function () {
                        window.location.href = '?d=' + encodeURIComponent(key);
                    });
                    list.appendChild(item);
                });
            } catch (error) {
                console.error(error);
            }
        }

        handleRedirect();

        const codeInput = document.getElementById('code-input');
        const goButton = document.getElementById('go-button');

        function goToCode() {
            if (!codeInput) return;
            const value = codeInput.value.trim();
            if (!value) return;
            window.location.href = '?d=' + encodeURIComponent(value);
        }

        if (codeInput) {
            codeInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    goToCode();
                }
            });
        }

        if (goButton) {
            goButton.addEventListener('click', function () {
                goToCode();
            });
        }

        window.addEventListener('load', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const hasParam = !!urlParams.get('d');
            const path = window.location.pathname.replace(/^\//, '').replace(/\/$/, '');
            if (!hasParam && !path) {
                loadLinks();
            }
        });
    </script>
</body>


</html>
